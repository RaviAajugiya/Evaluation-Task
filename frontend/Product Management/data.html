<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <!-- Include jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <!-- Include DataTables CSS and JS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>

    <!-- Include SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

    <!-- Include Toastify CSS and JS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
</head>

<body>
    <table id="data-table">
        <!-- Table content will be dynamically generated here -->
    </table>

    <script>
        $(document).ready(function () {
            var dataTable = $('#data-table').DataTable({
                ajax: {
                    url: 'https://localhost:44309/api/data',
                    type: 'GET',
                    dataType: 'json',
                    dataSrc: ''
                },
                columns: [
                    { title: 'partyId', data: 'partyId' },
                    { title: 'partyName', data: 'partyName' },
                    {
                        title: 'Actions',
                        render: function (data, type, row) {
                            return '<button class="btn-delete" data-party-id="' + row.partyId + '">Delete</button>';
                        }
                    }
                ]
            });

            // Handle delete button click
            $('#data-table').on('click', '.btn-delete', function () {
                var partyId = $(this).data('party-id');

                // Show confirmation dialog
                Swal.fire({
                    title: 'Are you sure?',
                    text: 'You won\'t be able to revert this!',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, delete it!'
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Call your delete API here, e.g., using jQuery AJAX
                        $.ajax({
                            url: 'https://localhost:44309/api/party/' + partyId,
                            type: 'DELETE',
                            success: function (data) {
                                // Reload the DataTable after successful deletion
                                dataTable.ajax.reload();

                                // Show success toast
                                Toastify({
                                    text: 'Data deleted successfully',
                                    duration: 3000,
                                    newWindow: true,
                                    close: true,
                                    gravity: 'top', // `top` or `bottom`
                                    position: 'right', // `left`, `center` or `right`
                                    backgroundColor: 'green',
                                    stopOnFocus: true,
                                }).showToast();
                            },
                            error: function (error) {
                                console.error('Error deleting record:', error);
                            }
                        });
                    }
                });
            });
        });
    </script>
</body>

</html>
